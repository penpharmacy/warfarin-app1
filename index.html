<!DOCTYPE html> 
<html lang="th">
<head>
<meta charset="UTF-8">
<title>คำนวณ Warfarin</title>
<style>
  body { font-family: Tahoma, sans-serif; padding: 20px; background: linear-gradient(135deg, #fceabb, #f8b500); }
  table { border-collapse: collapse; margin-bottom: 15px; width: 100%; max-width: 500px; background: #fff3cd; border-radius: 10px; overflow: hidden; }
  th { background: #f59e0b; color: white; }
  td, th { border: 1px solid #ccc; padding: 8px; text-align: center; }
  input { width: 70px; text-align: center; border-radius: 6px; border: 1px solid #f59e0b; padding: 5px; }
  .result { font-weight: bold; margin-top: 15px; font-size: 1.2em; color: #b91c1c; background: #fff; padding: 10px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.2); display: inline-block; }
  button { background: #f59e0b; color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 10px; }
  button:hover { background: #d97706; }
</style>
</head>
<body>
<h2 style="color:#b45309">คำนวณ Warfarin ต่อสัปดาห์</h2>

<table>
  <tr>
    <th>วัน</th><th>2 mg (เม็ด)</th><th>3 mg (เม็ด)</th>
  </tr>
  <script>
    const days = ["จันทร์","อังคาร","พุธ","พฤหัสบดี","ศุกร์","เสาร์","อาทิตย์"];
    for(let i=0;i<7;i++){
      document.write(`<tr>
        <td>${days[i]}</td>
        <td><input type="number" step="0.5" id="d2_${i}" value="" min="0"></td>
        <td><input type="number" step="0.5" id="d3_${i}" value="" min="0"></td>
      </tr>`);
    }
  </script>
</table>

<label>ค่าเดิม (mg/สัปดาห์): </label>
<input type="number" id="oldDose" value="" step="0.5"><br><br>

<label>จำนวนวันนัด: </label>
<input type="number" id="numDays" value="7" min="1" step="1"><br><br>

<button onclick="calculate()">คำนวณ</button>

<div class="result" id="output">กรอกข้อมูลเพื่อคำนวณ</div>

<script>
function calculate(){
  let totalWeekly7 = 0;  // สำหรับผลต่าง fix 7 วัน
  let total2 = 0;
  let total3 = 0;
  
  for(let i=0;i<7;i++){
    let n2 = parseFloat(document.getElementById("d2_"+i).value)||0;
    let n3 = parseFloat(document.getElementById("d3_"+i).value)||0;
    total2 += n2;
    total3 += n3;
    totalWeekly7 += (n2*2) + (n3*3);
  }

  let oldDose = parseFloat(document.getElementById("oldDose").value)||0;
  let numDays = parseInt(document.getElementById("numDays").value)||7;
  let factor = numDays / 7;

  let total2ToGive = Math.ceil(total2 * factor);
  let total3ToGive = Math.ceil(total3 * factor);
  let totalMgToGive = total2ToGive*2 + total3ToGive*3;

  let msg = `จำนวนวันที่นัด: ${numDays} วัน<br>`;
  msg += `จำนวนเม็ดที่ควรจ่ายจริง: 2 mg = ${total2ToGive} เม็ด, 3 mg = ${total3ToGive} เม็ด (รวม ${totalMgToGive} mg)<br><br>`;

  if(oldDose>0){
    // ผลต่าง fix 7 วัน
    let diffMg = totalWeekly7 - oldDose;
    let diffPct = ((diffMg)/oldDose*100).toFixed(2);
    if(diffMg>0){
      msg += `เพิ่มขึ้น ${diffMg} mg (+${diffPct}%) จากค่าเดิม`;
    } else if(diffMg<0){
      msg += `ลดลง ${Math.abs(diffMg)} mg (${diffPct}%) จากค่าเดิม`;
    } else{
      msg += `ปริมาณเท่าเดิม (0 mg / 0% เปลี่ยนแปลง)`;
    }
  }

  document.getElementById("output").innerHTML = msg;
}
</script>
</body>
</html>

